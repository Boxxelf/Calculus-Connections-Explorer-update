<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculus Concept Map</title>
    <link rel="stylesheet" href="style.css">
    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odQ+Qb3x/AvIBgFhn+dZJ4+ICvX" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
</head>
<body>
    <div id="instructions-overlay" class="instructions-overlay">
        <div class="instructions-modal">
            <button type="button" id="instructions-close" class="instructions-close" aria-label="Close instructions">&times;</button>
            <h2>How to Explore CS–Calculus Connections</h2>
            <p class="instructions-tagline">
                Discover how computer science topics connect to key calculus ideas and why those links matter.
            </p>
            <ol class="instructions-steps">
                <li>
                    <strong>Select CS topics:</strong>
                    Use the list under "CS Topics" to choose one or more CS topics or entire courses.
                    You can combine multiple selections to see overlapping calculus needs.
                </li>
                <li>
                    <strong>Browse connected calculus ideas:</strong>
                    The middle panel shows a ranked list of calculus topics that are connected to your CS selections.
                    Darker colors indicate topics with more or stronger connections.
                </li>
                <li>
                    <strong>Open details for a calculus topic:</strong>
                    Click any colored calculus pill to focus the graph on that topic and its nearby connections.
                </li>
                <li>
                    <strong>Read rationales:</strong>
                    After you click a pill, the right-hand sidebar shows written explanations ("rationales")
                    that describe how the selected calculus idea supports the CS topics you chose.
                    These rationales are automatically filtered by your current CS selections.
                </li>
                <li>
                    <strong>Full concept map (optional):</strong>
                    Switch to the "Full concept map" tab in the middle panel to see the original graph-based visualization
                    and zoom or pan around it.
                </li>
            </ol>
            <div class="instructions-actions">
                <button type="button" id="instructions-dismiss" class="primary-btn">Start Exploring</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="sidebar-left">
            <div class="sidebar-header">
                <h2>Explore</h2>
                <button type="button" id="instructions-open" class="instructions-button">Instructions</button>
            </div>

            <div class="sidebar-section">
                <h3>CS Topics</h3>
                <div id="cs-topic-tree" class="cs-topic-tree">
                    <!-- CS topics will be inserted here -->
                </div>
                <button type="button" id="cs-topic-clear" class="tertiary-btn">Clear CS Selection</button>
            </div>

            <div class="sidebar-section">
                <h3>Calculus Courses</h3>
                <div id="calculus-tree" class="calculus-tree">
                    <!-- Calculus hierarchy will be inserted here -->
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="main-header">
                <div class="main-title-group">
                    <h1>Calculus Connections Explorer</h1>
                    <p class="main-subtitle">Select CS topics on the left to see connected calculus ideas, prerequisites, and rationales.</p>
                </div>
                <div class="main-header-right">
                    <div id="course-selection-summary" class="course-selection-summary"></div>
                </div>
            </div>
            <div class="chart-container">
                <div class="view-tabs">
                    <button type="button" id="calc-list-tab" class="view-tab active">Connected calculus list</button>
                    <button type="button" id="full-map-tab" class="view-tab">Full concept map</button>
                </div>

                <div id="calc-list-panel" class="calc-list-panel">
                    <div class="calc-list-header">
                        <div id="cs-selection-summary" class="cs-selection-summary"></div>
                        <div class="calc-list-filters">
                            <label class="calc-filter">
                                <span>Min connections per calculus topic</span>
                                <div class="calc-filter-control">
                                    <input type="range" id="connection-threshold" min="1" max="1" value="1">
                                    <span id="connection-threshold-value">1</span>
                                </div>
                            </label>
                            <label class="calc-filter">
                                <span>Sort by</span>
                                <select id="calc-sort-mode">
                                    <option value="default">Course &amp; topic order</option>
                                    <option value="connections">Connections (most to fewest)</option>
                                    <option value="alpha">Topic name (A–Z)</option>
                                </select>
                            </label>
                        </div>
                    </div>
                    <div id="calc-list-empty" class="empty-state calc-list-empty">
                        <h3>Select CS Topics</h3>
                        <p>Choose a CS course or topic on the left to see the list of connected calculus ideas here.</p>
                    </div>
                    <div id="calc-topic-list" class="calc-topic-list">
                        <!-- Connected calculus topics will be rendered here -->
                    </div>
                </div>

                <div id="chart-panel" class="chart-panel hidden">
                    <svg id="chart"></svg>
                </div>
            </div>
        </div>
        
        <div class="sidebar-right">
            <div id="rationale-display" class="hidden">
                <h3>Details</h3>
                <h4 id="rationale-title"></h4>
                <p id="rationale-level"></p>
                <div id="rationale-content"></div>
            </div>

            <div id="empty-selection" class="empty-state">
                <h3>Select a Calculus Topic</h3>
                <p>Click any node in the visualization or in the hierarchy to view rationales that match the active CS topic filters.</p>
            </div>
        </div>
    </div>

    <div class="tooltip" style="opacity:0;"></div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="app.js?v=20"></script>
</body>
</html>